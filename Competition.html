<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StepSquad Local Competition</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .scroller::-webkit-scrollbar { width: 6px; }
        .scroller::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 3px; }
        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module" data-presets="react">
        const { useState, useEffect, useMemo } = React;

        // --- Local Storage Service ---
        const STORAGE_KEY = 'step_squad_local_data';

        const Storage = {
            getData: () => {
                const data = localStorage.getItem(STORAGE_KEY);
                return data ? JSON.parse(data) : [];
            },
            saveData: (users) => {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(users));
            },
            createUser: (name) => {
                const users = Storage.getData();
                const newUser = {
                    id: Date.now().toString(), // Simple ID generation
                    name: name,
                    steps: 0,
                    lastUpdated: new Date().toISOString()
                };
                users.push(newUser);
                Storage.saveData(users);
                return newUser;
            },
            addSteps: (userId, amount) => {
                const users = Storage.getData();
                const userIndex = users.findIndex(u => u.id === userId);
                if (userIndex !== -1) {
                    users[userIndex].steps += amount;
                    users[userIndex].lastUpdated = new Date().toISOString();
                    Storage.saveData(users);
                    return users; // Return updated list
                }
                return users;
            },
            resetUser: (userId) => {
                const users = Storage.getData();
                const userIndex = users.findIndex(u => u.id === userId);
                if (userIndex !== -1) {
                    users[userIndex].steps = 0;
                    users[userIndex].lastUpdated = new Date().toISOString();
                    Storage.saveData(users);
                    return users;
                }
                return users;
            }
        };

        // --- Components ---

        const UserSelectScreen = ({ users, onSelectUser, onCreateUser }) => {
            const [newName, setNewName] = useState("");
            const [isCreating, setIsCreating] = useState(false);

            const handleCreate = (e) => {
                e.preventDefault();
                if (newName.trim()) {
                    onCreateUser(newName.trim());
                    setNewName("");
                    setIsCreating(false);
                }
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-6 bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900">
                    <div className="w-full max-w-md bg-white rounded-2xl shadow-2xl overflow-hidden animate-fade-in">
                        <div className="bg-orange-500 p-8 text-center">
                            <i className="fas fa-trophy text-5xl text-white mb-2 shadow-sm"></i>
                            <h1 className="text-3xl font-bold text-white tracking-tight">StepSquad</h1>
                            <p className="text-orange-100 mt-2">Local Competition</p>
                        </div>
                        
                        <div className="p-8">
                            {!isCreating ? (
                                <>
                                    <h2 className="text-lg font-bold text-gray-700 mb-4">Who is logging steps?</h2>
                                    
                                    <div className="space-y-3 max-h-60 overflow-y-auto scroller mb-6">
                                        {users.length === 0 && (
                                            <p className="text-center text-gray-400 py-4 italic">No runners yet. Start the competition!</p>
                                        )}
                                        {users.map(user => (
                                            <button
                                                key={user.id}
                                                onClick={() => onSelectUser(user)}
                                                className="w-full flex items-center justify-between p-4 bg-gray-50 hover:bg-orange-50 border border-gray-200 hover:border-orange-300 rounded-xl transition-all group"
                                            >
                                                <span className="font-bold text-slate-700 group-hover:text-orange-700">{user.name}</span>
                                                <div className="flex items-center gap-3">
                                                    <span className="text-xs text-gray-400 font-mono">{user.steps.toLocaleString()} steps</span>
                                                    <i className="fas fa-chevron-right text-gray-300 group-hover:text-orange-400"></i>
                                                </div>
                                            </button>
                                        ))}
                                    </div>

                                    <button 
                                        onClick={() => setIsCreating(true)}
                                        className="w-full bg-slate-900 text-white font-bold py-4 rounded-lg hover:bg-slate-800 transition-colors flex justify-center items-center gap-2"
                                    >
                                        <i className="fas fa-plus"></i> New Competitor
                                    </button>
                                </>
                            ) : (
                                <form onSubmit={handleCreate} className="space-y-6 animate-fade-in">
                                    <div>
                                        <label className="block text-sm font-semibold text-gray-600 mb-2">New Athlete Name</label>
                                        <input 
                                            type="text" 
                                            value={newName}
                                            onChange={(e) => setNewName(e.target.value)}
                                            className="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-orange-500 focus:border-transparent outline-none text-lg"
                                            placeholder="e.g., Lightning Larry"
                                            maxLength={15}
                                            autoFocus
                                            required
                                        />
                                    </div>
                                    <div className="grid grid-cols-2 gap-3">
                                        <button 
                                            type="button" 
                                            onClick={() => setIsCreating(false)}
                                            className="w-full bg-gray-100 text-gray-600 font-bold py-3 rounded-lg hover:bg-gray-200 transition-colors"
                                        >
                                            Cancel
                                        </button>
                                        <button 
                                            type="submit" 
                                            disabled={!newName.trim()}
                                            className="w-full bg-orange-500 text-white font-bold py-3 rounded-lg hover:bg-orange-600 transition-colors disabled:opacity-50"
                                        >
                                            Create
                                        </button>
                                    </div>
                                </form>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const StatCard = ({ label, value, icon, color }) => (
            <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex items-center justify-between">
                <div>
                    <p className="text-xs font-bold text-gray-400 uppercase tracking-wider">{label}</p>
                    <p className="text-2xl font-bold text-slate-800 mt-1">{value}</p>
                </div>
                <div className={`w-10 h-10 rounded-full flex items-center justify-center ${color}`}>
                    <i className={`fas ${icon} text-white`}></i>
                </div>
            </div>
        );

        const LeaderboardItem = ({ rank, user, isCurrentUser }) => {
            let rankColor = "bg-gray-100 text-gray-500";
            let icon = null;

            if (rank === 1) {
                rankColor = "bg-yellow-100 text-yellow-600 border border-yellow-200";
                icon = "fa-crown";
            } else if (rank === 2) {
                rankColor = "bg-slate-200 text-slate-600";
                icon = "fa-medal";
            } else if (rank === 3) {
                rankColor = "bg-orange-100 text-orange-600";
                icon = "fa-medal";
            }

            return (
                <div className={`flex items-center p-3 rounded-xl mb-2 transition-all ${isCurrentUser ? 'bg-orange-50 border-2 border-orange-500 shadow-md transform scale-[1.02]' : 'bg-white border border-gray-100'}`}>
                    <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm mr-3 ${rankColor}`}>
                        {icon ? <i className={`fas ${icon}`}></i> : rank}
                    </div>
                    <div className="flex-1">
                        <h3 className={`font-semibold ${isCurrentUser ? 'text-orange-900' : 'text-slate-700'}`}>
                            {user.name} {isCurrentUser && <span className="text-xs bg-orange-200 text-orange-800 px-1.5 py-0.5 rounded ml-1">YOU</span>}
                        </h3>
                    </div>
                    <div className="text-right">
                        <span className="block font-bold text-lg text-slate-800">{user.steps.toLocaleString()}</span>
                        <span className="text-[10px] text-gray-400 uppercase font-bold">Steps</span>
                    </div>
                </div>
            );
        };

        const Dashboard = ({ currentUser, users, onAddSteps, onReset, onSwitchUser }) => {
            const [stepsInput, setStepsInput] = useState("");

            // Process users for leaderboard
            const sortedUsers = useMemo(() => {
                return [...users].sort((a, b) => b.steps - a.steps);
            }, [users]);

            const userData = users.find(u => u.id === currentUser.id) || currentUser;

            const myRank = useMemo(() => {
                const index = sortedUsers.findIndex(u => u.id === currentUser.id);
                return index !== -1 ? index + 1 : '-';
            }, [sortedUsers, currentUser.id]);

            const diffFromLeader = useMemo(() => {
                if (sortedUsers.length === 0) return 0;
                const topSteps = sortedUsers[0].steps;
                const mySteps = userData.steps || 0;
                return Math.max(0, topSteps - mySteps);
            }, [sortedUsers, userData]);

            const handleAdd = (e) => {
                e.preventDefault();
                const amount = parseInt(stepsInput);
                if (!amount || amount <= 0) return;
                onAddSteps(amount);
                setStepsInput("");
            };

            return (
                <div className="min-h-screen bg-slate-50 pb-20 md:pb-0 md:flex md:h-screen overflow-hidden">
                    
                    {/* Mobile Header */}
                    <div className="md:hidden bg-slate-900 text-white p-4 sticky top-0 z-10 shadow-lg">
                        <div className="flex justify-between items-center">
                            <div className="flex items-center gap-2">
                                <i className="fas fa-trophy text-orange-500"></i>
                                <span className="font-bold text-lg">StepSquad</span>
                            </div>
                            <button onClick={onSwitchUser} className="text-xs bg-slate-800 hover:bg-slate-700 px-3 py-1 rounded-full border border-slate-700 transition-colors">
                                <i className="fas fa-exchange-alt mr-1 text-orange-400"></i> Switch
                            </button>
                        </div>
                    </div>

                    {/* Left Panel: Inputs & Stats */}
                    <div className="p-4 md:w-1/3 md:p-8 md:bg-white md:border-r md:border-gray-200 md:h-full md:overflow-y-auto">
                        <div className="hidden md:flex items-center justify-between mb-8">
                            <div className="flex items-center gap-3">
                                <div className="bg-orange-500 p-2 rounded-lg">
                                    <i className="fas fa-trophy text-white text-xl"></i>
                                </div>
                                <h1 className="text-2xl font-bold text-slate-900">StepSquad</h1>
                            </div>
                            <button 
                                onClick={onSwitchUser}
                                className="text-xs font-bold text-gray-500 hover:text-orange-500 flex items-center gap-1 transition-colors"
                            >
                                <i className="fas fa-exchange-alt"></i> SWITCH USER
                            </button>
                        </div>

                        <div className="mb-6">
                            <h2 className="text-xl font-bold text-slate-800">Hello, {userData.name} üëã</h2>
                            <p className="text-sm text-gray-400">Keep it moving!</p>
                        </div>

                        {/* Stats Grid */}
                        <div className="grid grid-cols-2 gap-3 mb-6">
                            <StatCard 
                                label="My Steps" 
                                value={userData.steps.toLocaleString()} 
                                icon="fa-shoe-prints" 
                                color="bg-orange-500" 
                            />
                            <StatCard 
                                label="Rank" 
                                value={`#${myRank}`} 
                                icon="fa-chart-line" 
                                color="bg-slate-800" 
                            />
                        </div>

                        {/* Status Message */}
                        <div className="bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl p-4 text-white mb-6 shadow-lg relative overflow-hidden">
                             <div className="relative z-10">
                                {myRank === 1 ? (
                                    <>
                                        <h3 className="font-bold text-lg mb-1">You are leading! üèÜ</h3>
                                        <p className="text-indigo-100 text-sm">Don't let {sortedUsers[1]?.name || "anyone"} catch you.</p>
                                    </>
                                ) : (
                                    <>
                                        <h3 className="font-bold text-lg mb-1">{diffFromLeader.toLocaleString()} steps behind</h3>
                                        <p className="text-indigo-100 text-sm">Catch up to {sortedUsers[0]?.name || "Leader"}!</p>
                                    </>
                                )}
                            </div>
                            <i className="fas fa-running absolute -bottom-2 -right-2 text-6xl text-white opacity-20 transform -rotate-12"></i>
                        </div>

                        {/* Input Form */}
                        <div className="bg-white p-5 rounded-xl shadow-sm border border-gray-100 md:border-none md:p-0 md:shadow-none md:bg-transparent">
                            <h2 className="font-bold text-slate-800 mb-4 flex items-center gap-2">
                                <i className="fas fa-plus-circle text-orange-500"></i> Log Activity
                            </h2>
                            <form onSubmit={handleAdd} className="space-y-3">
                                <div>
                                    <label className="text-xs font-semibold text-gray-500 uppercase">Steps to Add</label>
                                    <div className="relative mt-1">
                                        <input 
                                            type="number" 
                                            value={stepsInput}
                                            onChange={(e) => setStepsInput(e.target.value)}
                                            placeholder="0"
                                            className="w-full pl-4 pr-12 py-3 bg-gray-50 border border-gray-200 rounded-lg font-mono text-lg focus:ring-2 focus:ring-orange-500 outline-none transition-all"
                                            min="1"
                                            max="100000"
                                        />
                                        <span className="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 text-xs font-bold">STEPS</span>
                                    </div>
                                </div>
                                <div className="grid grid-cols-2 gap-2">
                                    <button 
                                        type="button" 
                                        onClick={() => setStepsInput(prev => String((parseInt(prev) || 0) + 1000))}
                                        className="py-2 px-3 bg-gray-100 text-gray-600 rounded-lg text-sm font-semibold hover:bg-gray-200 transition-colors"
                                    >
                                        +1,000
                                    </button>
                                    <button 
                                        type="button" 
                                        onClick={() => setStepsInput(prev => String((parseInt(prev) || 0) + 5000))}
                                        className="py-2 px-3 bg-gray-100 text-gray-600 rounded-lg text-sm font-semibold hover:bg-gray-200 transition-colors"
                                    >
                                        +5,000
                                    </button>
                                </div>
                                <button 
                                    type="submit" 
                                    disabled={!stepsInput}
                                    className="w-full bg-slate-900 text-white font-bold py-3 rounded-lg hover:bg-slate-800 active:scale-[0.98] transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-slate-900/20"
                                >
                                    Add Steps
                                </button>
                            </form>
                            
                            <div className="mt-6 pt-6 border-t border-gray-100">
                                <button 
                                    onClick={() => {
                                        if(confirm("Are you sure you want to reset your score to 0? This cannot be undone.")) {
                                            onReset();
                                        }
                                    }}
                                    className="text-xs text-red-500 hover:text-red-700 font-semibold flex items-center gap-1"
                                >
                                    <i className="fas fa-trash-alt"></i> Reset My Score
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* Right Panel: Leaderboard */}
                    <div className="p-4 md:w-2/3 md:p-8 md:bg-slate-50 md:h-full md:overflow-hidden flex flex-col">
                        <div className="flex items-center justify-between mb-4 md:mb-6">
                            <h2 className="font-bold text-xl text-slate-800">Local Leaderboard</h2>
                            <div className="text-xs font-medium text-gray-500 bg-white px-3 py-1 rounded-full border border-gray-200 shadow-sm">
                                <i className="fas fa-users mr-1"></i> {sortedUsers.length} Competitors
                            </div>
                        </div>

                        <div className="flex-1 overflow-y-auto scroller pb-20 md:pb-0">
                            {sortedUsers.length === 0 ? (
                                <div className="text-center py-20 text-gray-400">
                                    <i className="fas fa-wind text-4xl mb-3"></i>
                                    <p>No competitors yet. Be the first!</p>
                                </div>
                            ) : (
                                sortedUsers.map((u, index) => (
                                    <LeaderboardItem 
                                        key={u.id} 
                                        rank={index + 1} 
                                        user={u} 
                                        isCurrentUser={u.id === currentUser.id} 
                                    />
                                ))
                            )}
                        </div>
                    </div>

                </div>
            );
        };

        const App = () => {
            const [users, setUsers] = useState([]);
            const [currentUser, setCurrentUser] = useState(null);

            useEffect(() => {
                const loadedUsers = Storage.getData();
                setUsers(loadedUsers);
            }, []);

            const handleCreateUser = (name) => {
                const newUser = Storage.createUser(name);
                setUsers(Storage.getData()); // Refresh list
                setCurrentUser(newUser); // Auto login
            };

            const handleSelectUser = (user) => {
                setCurrentUser(user);
            };

            const handleAddSteps = (amount) => {
                const updatedUsers = Storage.addSteps(currentUser.id, amount);
                setUsers(updatedUsers);
            };

            const handleReset = () => {
                const updatedUsers = Storage.resetUser(currentUser.id);
                setUsers(updatedUsers);
            };

            const handleSwitchUser = () => {
                setCurrentUser(null);
            };

            if (!currentUser) {
                return (
                    <UserSelectScreen 
                        users={users} 
                        onSelectUser={handleSelectUser} 
                        onCreateUser={handleCreateUser} 
                    />
                );
            }

            return (
                <Dashboard 
                    currentUser={currentUser} 
                    users={users} 
                    onAddSteps={handleAddSteps}
                    onReset={handleReset}
                    onSwitchUser={handleSwitchUser}
                />
            );
        };

        const root = ReactDOM.createRoot(document.getElementById("root"));
        root.render(<App />);
    </script>
</body>
</html>